<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>اطلاعات مشتریان بانک سپه</title>
  <style>
    body {
      font-family: Tahoma, Arial, sans-serif;
      direction: rtl;
      margin: 20px;
      background-color: #f5f5f5;
    }
    
    h1 {
      color: #0c4b8e;
      text-align: center;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background-color: white;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .search-box {
      margin-bottom: 20px;
    }
    
    .search-box input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: Tahoma, Arial, sans-serif;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
    }
    
    th, td {
      padding: 10px;
      text-align: right;
      border-bottom: 1px solid #ddd;
    }
    
    th {
      background-color: #0c4b8e;
      color: white;
    }
    
    tr:nth-child(even) {
      background-color: #f2f2f2;
    }
    
    tr:hover {
      background-color: #e6e6e6;
    }
    
    .loading {
      text-align: center;
      padding: 20px;
      font-size: 18px;
      color: #666;
    }
    
    .error {
      background-color: #ffebee;
      color: #c62828;
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .stat-card {
      background-color: white;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      flex: 1;
      min-width: 150px;
      margin: 5px;
      text-align: center;
    }
    
    .stat-value {
      font-size: 24px;
      font-weight: bold;
      color: #0c4b8e;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>اطلاعات مشتریان بانک سپه</h1>
    
    <div id="errorMessage" class="error" style="display: none;"></div>
    
    <div class="stats">
      <div class="stat-card">
        <div>تعداد کل مشتریان</div>
        <div id="totalCustomers" class="stat-value">0</div>
      </div>
    </div>
    
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="جستجو بر اساس نام، کد ملی، محل تولد یا شماره موبایل...">
    </div>
    
    <div id="loading" class="loading">در حال بارگذاری اطلاعات...</div>
    
    <table id="customerTable" style="display: none;">
      <thead>
        <tr>
          <th>نام مشتری</th>
          <th>کد ملی</th>
          <th>محل تولد</th>
          <th>شماره موبایل</th>
          <th>گروه مشتریان</th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <!-- داده‌ها اینجا قرار می‌گیرند -->
      </tbody>
    </table>
  </div>

  <script>
    // متغیرهای سراسری
    let allCustomers = [];
    let filteredCustomers = [];
    
    // اجرای کد پس از بارگذاری صفحه
    document.addEventListener('DOMContentLoaded', function() {
      // بارگذاری داده‌ها
      loadData();
      
      // تنظیم رویداد جستجو
      document.getElementById('searchInput').addEventListener('input', function() {
        filterData(this.value);
      });
    });
    
    // بارگذاری داده‌ها از فایل JSON
    function loadData() {
      // نمایش وضعیت بارگذاری
      document.getElementById('loading').style.display = 'block';
      document.getElementById('customerTable').style.display = 'none';
      
      // تلاش برای بارگذاری داده‌ها از فایل
      fetch('data/sepahbilion.json')
        .then(response => {
          if (!response.ok) {
            throw new Error(`فایل یافت نشد: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          // ذخیره داده‌ها در متغیر سراسری
          allCustomers = data;
          
          // بروزرسانی آمار
          document.getElementById('totalCustomers').textContent = allCustomers.length.toLocaleString('fa-IR');
          
          // مخفی کردن وضعیت بارگذاری
          document.getElementById('loading').style.display = 'none';
          document.getElementById('customerTable').style.display = 'table';
          
          // نمایش داده‌ها
          filteredCustomers = allCustomers;
          displayData(filteredCustomers);
          console.log(`${allCustomers.length} رکورد از فایل بارگذاری شد.`);
        })
        .catch(error => {
          console.error('خطا در بارگذاری داده‌ها:', error);
          
          // نمایش پیام خطا با جزئیات بیشتر
          document.getElementById('loading').style.display = 'none';
          document.getElementById('errorMessage').style.display = 'block';
          document.getElementById('errorMessage').textContent = `خطا در بارگذاری اطلاعات: ${error.message}. لطفاً مطمئن شوید فایل sepahbilion.json در پوشه data قرار دارد.`;
          
          // استفاده از داده‌های نمونه در صورت خطا
          allCustomers = [
            {
              "name": "كيوان كركودي",
              "national_id": "3256268145",
              "birth_place": "کرمانشاه",
              "mobile": "09362603905",
              "customer_group": "مشتری عادی"
            },
            {
              "name": "نام مشتری 2",
              "national_id": "9876543210",
              "birth_place": "تهران",
              "mobile": "09123456789",
              "customer_group": "مشتری ویژه"
            }
          ];
          
          // بروزرسانی آمار
          document.getElementById('totalCustomers').textContent = allCustomers.length.toLocaleString('fa-IR');
          
          // نمایش داده‌های نمونه
          document.getElementById('customerTable').style.display = 'table';
          filteredCustomers = allCustomers;
          displayData(filteredCustomers);
        });
    }
    
    // فیلتر داده‌ها بر اساس متن جستجو
    function filterData(searchText) {
      if (!searchText) {
        // اگر متن جستجو خالی باشد، همه داده‌ها را نمایش بده
        filteredCustomers = allCustomers;
      } else {
        searchText = searchText.toLowerCase();
        
        // فیلتر داده‌ها بر اساس متن جستجو
        filteredCustomers = allCustomers.filter(customer => 
          customer.name.toLowerCase().includes(searchText) ||
          customer.national_id.includes(searchText) ||
          customer.birth_place.toLowerCase().includes(searchText) ||
          customer.mobile.includes(searchText)
        );
      }
      
      // نمایش داده‌های فیلتر شده
      displayData(filteredCustomers);
    }
    
    // نمایش داده‌ها در جدول با پردازش تدریجی
    function displayData(customers) {
      const tableBody = document.getElementById('tableBody');
      tableBody.innerHTML = '';
      
      // اگر تعداد داده‌ها زیاد است، از پردازش تدریجی استفاده کن
      if (customers.length > 1000) {
        displayLargeDataset(customers);
      } else {
        // برای داده‌های کوچک، همه را یکجا نمایش بده
        const fragment = document.createDocumentFragment();
        
        customers.forEach(customer => {
          const row = createCustomerRow(customer);
          fragment.appendChild(row);
        });
        
        tableBody.appendChild(fragment);
      }
    }
    
    // نمایش داده‌های بزرگ به صورت تدریجی
    function displayLargeDataset(customers) {
      const tableBody = document.getElementById('tableBody');
      const batchSize = 100; // تعداد رکوردهایی که در هر مرحله پردازش می‌شوند
      let index = 0;
      
      function processBatch() {
        const fragment = document.createDocumentFragment();
        const end = Math.min(index + batchSize, customers.length);
        
        for (let i = index; i < end; i++) {
          const row = createCustomerRow(customers[i]);
          fragment.appendChild(row);
        }
        
        tableBody.appendChild(fragment);
        index = end;
        
        // اگر هنوز رکوردهایی باقی مانده‌اند، مرحله بعدی را برنامه‌ریزی کن
        if (index < customers.length) {
          setTimeout(processBatch, 0);
        }
      }
      
      // شروع پردازش تدریجی
      processBatch();
    }
    
    // ایجاد یک ردیف جدول برای یک مشتری
    function createCustomerRow(customer) {
      const row = document.createElement('tr');
      
      // نام مشتری
      const nameCell = document.createElement('td');
      nameCell.textContent = customer.name;
      row.appendChild(nameCell);
      
      // کد ملی
      const nationalIdCell = document.createElement('td');
      nationalIdCell.textContent = customer.national_id;
      row.appendChild(nationalIdCell);
      
      // محل تولد
      const birthPlaceCell = document.createElement('td');
      birthPlaceCell.textContent = customer.birth_place;
      row.appendChild(birthPlaceCell);
      
      // شماره موبایل
      const mobileCell = document.createElement('td');
      mobileCell.textContent = customer.mobile;
      row.appendChild(mobileCell);
      
      // گروه مشتریان
      const customerGroupCell = document.createElement('td');
      customerGroupCell.textContent = customer.customer_group;
      row.appendChild(customerGroupCell);
      
      return row;
    }
  </script>
</body>
</html>
