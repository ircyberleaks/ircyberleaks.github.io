<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>اطلاعات مشتریان بانک سپه</title>
  <style>
    body {
      font-family: Tahoma, Arial, sans-serif;
      direction: rtl;
      margin: 20px;
      background-color: #f5f5f5;
    }
    
    h1 {
      text-align: center;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background-color: white;
      padding: 20px;
    }
    
    .search-box {
      margin-bottom: 20px;
    }
    
    .search-box input {
      width: 100%;
      padding: 10px;
      font-family: Tahoma, Arial, sans-serif;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
    }
    
    th, td {
      padding: 8px;
      text-align: right;
      border: 1px solid #ddd;
    }
    
    th {
      background-color: #f2f2f2;
    }
    
    .loading {
      text-align: center;
      padding: 20px;
    }
    
    .error {
      color: red;
      text-align: center;
      padding: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>اطلاعات مشتریان بانک سپه</h1>
    
    <div id="errorMessage" class="error" style="display: none;"></div>
    <div id="loading" class="loading">در حال بارگذاری اطلاعات...</div>
    
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="جستجو...">
    </div>
    
    <table id="customerTable" style="display: none;">
      <thead>
        <tr>
          <th>نام مشتری</th>
          <th>کد ملی</th>
          <th>محل تولد</th>
          <th>شماره موبایل</th>
          <th>گروه مشتریان</th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <!-- داده‌ها اینجا قرار می‌گیرند -->
      </tbody>
    </table>
  </div>

  <script>
    // اجرای کد پس از بارگذاری صفحه
    document.addEventListener('DOMContentLoaded', function() {
      // بارگذاری داده‌ها
      loadData();
      
      // تنظیم رویداد جستجو
      document.getElementById('searchInput').addEventListener('input', function() {
        filterTable(this.value);
      });
    });
    
    // بارگذاری داده‌ها از فایل HTML
    function loadData() {
      // نمایش وضعیت بارگذاری
      document.getElementById('loading').style.display = 'block';
      document.getElementById('customerTable').style.display = 'none';
      document.getElementById('errorMessage').style.display = 'none';
      
      // تلاش برای بارگذاری داده‌ها از فایل HTML - مسیر دقیق
      fetch('data/sepahbilion.html')
        .then(response => {
          if (!response.ok) {
            throw new Error(`فایل یافت نشد: ${response.status} ${response.statusText}`);
          }
          return response.text();
        })
        .then(html => {
          try {
            // پردازش HTML
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = html;
            
            // استخراج ردیف‌های جدول
            const rows = tempDiv.querySelectorAll('table tbody tr');
            
            if (rows.length === 0) {
              throw new Error('هیچ داده‌ای در فایل HTML یافت نشد');
            }
            
            // تبدیل هر ردیف به یک آبجکت مشتری
            const customers = [];
            rows.forEach(row => {
              const cells = row.querySelectorAll('td');
              if (cells.length >= 5) {
                const customer = {
                  name: cells[0].textContent.trim(),
                  national_id: cells[1].textContent.trim(),
                  birth_place: cells[2].textContent.trim(),
                  mobile: cells[3].textContent.trim(),
                  customer_group: cells[4].textContent.trim()
                };
                customers.push(customer);
              }
            });
            
            // مخفی کردن وضعیت بارگذاری
            document.getElementById('loading').style.display = 'none';
            document.getElementById('customerTable').style.display = 'table';
            
            // نمایش داده‌ها
            displayData(customers);
            console.log(`${customers.length} رکورد از فایل بارگذاری شد.`);
          } catch (error) {
            throw new Error(`خطا در پردازش HTML: ${error.message}`);
          }
        })
        .catch(error => {
          console.error('خطا در بارگذاری داده‌ها:', error);
          
          // نمایش پیام خطا با جزئیات بیشتر
          document.getElementById('loading').style.display = 'none';
          document.getElementById('errorMessage').style.display = 'block';
          document.getElementById('errorMessage').textContent = `خطا در بارگذاری اطلاعات: ${error.message}. استفاده از داده‌های نمونه...`;
          
          // استفاده از داده‌های نمونه در صورت خطا
          const sampleData = [
            {
              name: 'كيوان كركودي',
              national_id: '3256268145',
              birth_place: 'کرمانشاه',
              mobile: '09362603905',
              customer_group: 'مشتری عادی'
            },
            {
              name: 'محمدحامي نيازمندمنفردقلندرآبادي',
              national_id: '440956811',
              birth_place: 'شميران',
              mobile: '09121192525',
              customer_group: 'مشتری عادی'
            },
            {
              name: 'سيدسعيد ميربد',
              national_id: '1199029947',
              birth_place: 'شهرضا',
              mobile: '09138258015',
              customer_group: 'مشتری عادی'
            }
          ];
          
          // نمایش داده‌های نمونه
          document.getElementById('customerTable').style.display = 'table';
          displayData(sampleData);
        });
    }
    
    // نمایش داده‌ها در جدول با پردازش تدریجی
    function displayData(customers) {
      const tableBody = document.getElementById('tableBody');
      tableBody.innerHTML = '';
      
      // برای داده‌های بزرگ، از پردازش تدریجی استفاده می‌کنیم
      const batchSize = 500; // تعداد رکوردهایی که در هر مرحله پردازش می‌شوند
      let index = 0;
      
      function processBatch() {
        const fragment = document.createDocumentFragment();
        const end = Math.min(index + batchSize, customers.length);
        
        for (let i = index; i < end; i++) {
          const customer = customers[i];
          const row = document.createElement('tr');
          
          // نام مشتری
          const nameCell = document.createElement('td');
          nameCell.textContent = customer.name;
          row.appendChild(nameCell);
          
          // کد ملی
          const nationalIdCell = document.createElement('td');
          nationalIdCell.textContent = customer.national_id;
          row.appendChild(nationalIdCell);
          
          // محل تولد
          const birthPlaceCell = document.createElement('td');
          birthPlaceCell.textContent = customer.birth_place;
          row.appendChild(birthPlaceCell);
          
          // شماره موبایل
          const mobileCell = document.createElement('td');
          mobileCell.textContent = customer.mobile;
          row.appendChild(mobileCell);
          
          // گروه مشتریان
          const customerGroupCell = document.createElement('td');
          customerGroupCell.textContent = customer.customer_group;
          row.appendChild(customerGroupCell);
          
          fragment.appendChild(row);
        }
        
        tableBody.appendChild(fragment);
        index = end;
        
        // اگر هنوز رکوردهایی باقی مانده‌اند، مرحله بعدی را برنامه‌ریزی کن
        if (index < customers.length) {
          setTimeout(processBatch, 0);
        }
      }
      
      // شروع پردازش تدریجی
      processBatch();
    }
    
    // فیلتر جدول بر اساس متن جستجو
    function filterTable(searchText) {
      const tableBody = document.getElementById('tableBody');
      const rows = tableBody.getElementsByTagName('tr');
      
      searchText = searchText.toLowerCase();
      
      for (let i = 0; i < rows.length; i++) {
        const row = rows[i];
        const cells = row.getElementsByTagName('td');
        let found = false;
        
        for (let j = 0; j < cells.length; j++) {
          const cellText = cells[j].textContent.toLowerCase();
          if (cellText.includes(searchText)) {
            found = true;
            break;
          }
        }
        
        row.style.display = found ? '' : 'none';
      }
    }
  </script>
</body>
</html>
